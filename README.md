## NeoBuildBattleCore

Rethinking of original MC Build Battle gamemode. Современный, производительный и «честный» режим строительства для Paper/Spigot 1.21+, спроектированный с нуля под публичные сервера и мини‑игровые хабы.

- Быстрый старт партии, автоматический цикл «лобби → тема → стройка → оценка → финал → лобби»
- Матрица плотов с изоляцией игроков, ограничениями по высоте и антигриф‑защитой
- Голосование за тему через единый GUI (закрыть нельзя, пока идёт голосование)
- Удобная оценка построек с заголовками (Title), предметами‑оценками и табло результатов
- Продуманный режим наблюдателя: компас‑телепорт по участникам, скрытие наблюдателей, запрет на взаимодействия
- Автоматическая очистка арен, телепорт на плот победителя и фейерверки в финале


### Требования

- Java 21 (рекомендуется LTS)
- PaperMC/Spigot 1.21+ (рекомендуется Paper)
- Gradle (локально не обязателен — есть wrapper)


### Установка

1) Собрать плагин:

```bash
./gradlew build -x test
```

Готовый JAR появится в `build/libs/`.

2) Скопировать JAR на сервер в `server/plugins/` и запустить сервер один раз, чтобы сгенерировались конфиги и ресурсы.

3) Настроить координаты арен и лобби в `plugins/NeoBuildBattleCore/config.yml` (см. раздел «Конфигурация»).


### Конфигурация

Основной файл: `plugins/NeoBuildBattleCore/config.yml`.

Ключевые параметры:
- `max-players`: максимальное число игроков в партии
- `matrix-size`: число плотов по стороне (NxN)
- `build-area-size`: внутренняя область строительства, по умолчанию 65
- `plot-wall-height`: высота стен плота
- `plot-floor-material`, `plot-wall-material`, `plot-ring-material`: материалы пола/стен/внутреннего кольца
- `max-build-height`: максимальная высота строительства относительно уровня пола
- `countdown-seconds`, `theme-vote-seconds`, `build-seconds`, `evaluation-seconds-per-plot`: тайминги фаз
- `worlds.lobby`, `worlds.game`: имена миров для лобби и арены
- `lobby-spawn.*`: координаты спавна в лобби
- `arena-origin.*`: базовая точка раздачи плотов
- `plot-gap`: зазор между боксами

Темы для голосования: `plugins/NeoBuildBattleCore/themes.txt` (по одной теме в строке).


### Команды и права

- Команды (см. также `plugin.yml`):
  - `/neobb <forcestart|state <name>|end|debug>` — админ‑команды
  - `/neobbsetup <setlobbyspawn|setarenaorigin|setarenaworld>` — базовая настройка

- Права:
  - `neobb.admin` — доступ к админ‑командам (по умолчанию: op)
  - `neobb.setup` — доступ к настройке (по умолчанию: op)


### Геймплейный цикл

1) Ожидание в лобби, авто‑обратный отсчёт при достижении половины от `max-players`.
2) Голосование за тему: всем открывается общий GUI; закрыть нельзя до конца голосования.
3) Фаза строительства: участникам раздаются плоты; Creative, полёт, ограничение высоты и границ, запрет на строительство вне своего бокса.
4) Оценка: порядок плотов перемешивается; все телепортируются на точку обзора текущего плота, все — в Adventure с полётом; только участникам выдаются предметы‑оценки.
5) Финал: телепорт на плот победителя, ТОП‑3 в чат, персональные места, салюты; затем возврат в лобби и автоматический старт следующей игры.


### Антигриф и наблюдатели

- PvP полностью отключён.
- В фазах ThemeVoting/Evaluation и для наблюдателей запрещены:
  - взаимодействия с блоками/контейнерами/табличками/рамками и сущностями
  - дроп и подбор предметов
- Наблюдатели:
  - Adventure + полёт, компас «Телепорт» (GUI с головами участников)
  - Скрыты от всех игроков и друг от друга (через `hidePlayer`), могут телепортироваться по текущим оцениваемым постройкам
  - Эффекты очищаются при возврате в лобби


### Архитектура (вкратце)

- `GameManager` — состояние игры и переходы между фазами
- `PlotManager` — генерация боксов/стен/кольца/пола, выделение плотов, очистка арен
- `Plot` — границы, точки спавна и просмотра, предметы‑оценки
- `ThemeVotingManager` — GUI голосования тем, защита от закрытия
- `ScoreListener` — считывание голосов игроков‑участников
- `SpectatorManager` — режим наблюдателя, компас‑телепорт, скрытие игроков
- `ProtectionListener` — PVP‑off, запрет взаимодействий/дропа/подбора
- `Messages` — форматирование и вывод сообщений


### Сборка и разработка

- Java: 21+
- IDE: IntelliJ IDEA / Eclipse / VS Code
- Сборка: `./gradlew build -x test`
- Локальный стенд: Paper 1.21+, добавить собранный JAR в `plugins/`, при первом запуске настроить конфиг и миры.

Советы разработчикам:
- Используйте void‑миры для лобби/арены (предусмотрен генератор). Следите за корректной `arena-origin` и `matrix-size`.
- При изменении логики фаз — всегда проверяйте таймеры и переходы, чтобы не застревать между состояниями.


### Правила контрибьюции (GitHub)

Мы приветствуем pull‑requests. Чтобы ускорить ревью и релизы, пожалуйста, следуйте правилам ниже.

#### Бранчинг
- `main` — стабильная ветка, только через PR.
- `feat/<коротко‑о‑фиче>` — новые возможности
- `fix/<коротко‑о‑баге>` — исправления
- `chore/<тема>` — инфраструктура, зависимости, CI

#### Коммиты (Conventional Commits)
- `feat: ...` — новая функциональность
- `fix: ...` — исправление багов
- `refactor: ...`, `perf: ...`, `test: ...`, `docs: ...`, `chore: ...`
- На английском, кратко и по делу. При необходимости — body с деталями и ссылками на issue.

#### Оформление PR
- Один PR — одна логическая задача
- Описание: что изменено, почему, как тестировалось
- Скриншоты/видео — если затронут UX/GUI
- Добавьте список чеков (checklist), чтобы мы могли быстро пробежаться по требованиям

#### Код‑стайл
- Java 21, без `var` в публичных API; имена говорящие, без аббревиатур
- Предпочитайте ранние возвраты (guard clauses); избегайте глубокой вложенности
- Не оставляйте TODO — реализуйте или создавайте issue
- Объясняйте «почему» в комментариях, а не «что делает очевидный код»

#### Тестирование
- Локальная проверка на Paper 1.21+:
  - старт игры, выдача плотов, границы/высота, голосование, оценка, финал
  - антигриф: попытки взаимодействий/дропа/подбора
  - поведение наблюдателей: компас, телепорт, скрытие

#### Issues
- Баг‑репорт: шаги воспроизведения, ожидаемое vs фактическое поведение, лог сервера (если есть), версия Java/Paper
- Фича‑реквест: сценарий использования, UX, влияние на баланс/перформанс


### Дорожная карта (идеи)
- Настраиваемые пресеты оценок, кастомные GUI‑скины
- Доп. визуальные эффекты и анимации финала
- Интеграция с экономикой/наградами
- Публичный API для аддонов


### Лицензия

Проект распространяется под лицензией MIT (см. `LICENSE`).


### Благодарности

Идея вдохновлена оригинальным Build Battle, но реализована с нуля с акцентом на производительность, читабельность кода и качество UX.


